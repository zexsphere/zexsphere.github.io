<!doctype html><html lang=en><head><meta charset=utf-8><meta name=referrer content="same-origin"><title>Socket api :: Zex</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="socket api map +--------+ (AF_INET SOCK_STREAM) | socket | AF_INET6 SOCK_DGRAM +--+-----+ setsockopt() ------ SO_REUSEADDR | | SO_RCVBUF SO_SNDBUF +------------------+------------------+ | SO_RCVLOWAT SO_SNDLOWAT | | % - SO_LINGER | +--+-----+ | | bind | EADDRINUSE | +--+-----+ | | % | +--+-----+ | | listen | ESTABLISHED QUEUE % | +--+-----+ + SYN_RCVD QUEUE &amp;lt; backlog +--+------+ syn -&amp;gt; | ECONNREFUSED | connect +------------------------------+ ETIMEDOUT +--+------+ | %# | +--+-----+ | ( return one of | accept | (listening socket, ."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/post/0011/><link rel=stylesheet href=/assets/style.min.css?d41d8cd98f00b204e9800998ecf8427e><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/favicon/apple-icon-precomposed.png><link rel="shortcut icon" href=/img/favicon/orange.png><meta name=twitter:card content="summary"><meta property="og:type" content="article"><meta property="og:title" content="Socket api :: Zex"><meta property="og:description" content="Socket is an abstraction layer between the applicantion layer and the transport layer. It abstracts complex operations of the TCP/IP layer into several simple interfaces for the application layer to call and implement processes to communicate in the network."><meta property="og:url" content="/post/0011/"><meta property="og:site_name" content="Zex"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2023-09-29 15:58:47 +0800 +0800"></head><body><div class="container headings--one-size"><header class=header style=background-image:url(/img/mountain/mountains-g47d3aaa15_1280.jpg);background-position:50%;background-repeat:no-repeat;background-size:cover><div class=header__inner><div class=header__logo><a href=/><div class=logo>Zex</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>关于</a></li><li><a href=/archive>归档</a></li><li><a href=/series/life>生活</a></li><li><a href=/series/code>编程</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>关于</a></li><li><a href=/archive>归档</a></li><li><a href=/series/life>生活</a></li><li><a href=/series/code>编程</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title>Socket api</h1><div class=post-meta><span class=post-date>2023-09-29</span>
<span class=post-author>::
zexsphere</span></div><div class=post-content><div><h2 id=socket-api-map>socket api map<a href=#socket-api-map class=hanchor arialabel=Anchor>⚓</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl><span class=w>                                 </span><span class=o>+--------+</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=vg>AF_INET</span><span class=w>    </span><span class=vg>SOCK_STREAM</span><span class=p>)</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=vg>socket</span><span class=w> </span><span class=o>|</span>
</span></span><span class=line><span class=cl><span class=w> </span><span class=vg>AF_INET6</span><span class=w>   </span><span class=vg>SOCK_DGRAM</span><span class=w>           </span><span class=o>+--+-----+</span><span class=w>   </span><span class=vg>setsockopt</span><span class=p>()</span><span class=w> </span><span class=o>------</span><span class=w> </span><span class=vg>SO_REUSEADDR</span>
</span></span><span class=line><span class=cl><span class=w>                                    </span><span class=o>|</span><span class=w>                           </span><span class=o>|</span><span class=w> </span><span class=vg>SO_RCVBUF</span><span class=w>     </span><span class=vg>SO_SNDBUF</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>+------------------+------------------+</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=vg>SO_RCVLOWAT</span><span class=w>   </span><span class=vg>SO_SNDLOWAT</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>                                     </span><span class=o>|</span><span class=w> </span><span class=o>%</span><span class=w>      </span><span class=o>-</span><span class=w> </span><span class=vg>SO_LINGER</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>                                  </span><span class=o>+--+-----+</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>                                  </span><span class=o>|</span><span class=w> </span><span class=vg>bind</span><span class=w>   </span><span class=o>|</span><span class=w>  </span><span class=vg>EADDRINUSE</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>                                  </span><span class=o>+--+-----+</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>                                     </span><span class=o>|</span><span class=w> </span><span class=o>%</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>                                  </span><span class=o>+--+-----+</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>                                  </span><span class=o>|</span><span class=w> </span><span class=vg>listen</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=vg>ESTABLISHED</span><span class=w> </span><span class=vg>QUEUE</span>
</span></span><span class=line><span class=cl><span class=w>               </span><span class=o>%</span><span class=w> </span><span class=o>|</span><span class=w>                                  </span><span class=o>+--+-----+</span><span class=w>  </span><span class=o>+</span><span class=w> </span><span class=vg>SYN_RCVD</span><span class=w>  </span><span class=vg>QUEUE</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=vg>backlog</span>
</span></span><span class=line><span class=cl><span class=w>              </span><span class=o>+--+------+</span><span class=w> </span><span class=vg>syn</span><span class=w> </span><span class=o>-&gt;</span><span class=w>                       </span><span class=o>|</span>
</span></span><span class=line><span class=cl><span class=vg>ECONNREFUSED</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=vg>connect</span><span class=w> </span><span class=o>+------------------------------+</span>
</span></span><span class=line><span class=cl><span class=vg>ETIMEDOUT</span><span class=w>     </span><span class=o>+--+------+</span><span class=w>                              </span><span class=o>|</span><span class=w> </span><span class=o>%</span><span class=err>#</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>                                  </span><span class=o>+--+-----+</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>            </span><span class=p>(</span><span class=w> </span><span class=vg>return</span><span class=w> </span><span class=vg>one</span><span class=w> </span><span class=vg>of</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=vg>accept</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=p>(</span><span class=vg>listening</span><span class=w> </span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=w>                 </span><span class=o>|</span><span class=w>              </span><span class=vg>connected</span><span class=w> </span><span class=vg>sockets</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=o>+--+-----+</span>
</span></span><span class=line><span class=cl><span class=w>               </span><span class=o>%</span><span class=w> </span><span class=o>|</span><span class=w>                                     </span><span class=o>|</span><span class=w> </span><span class=o>%</span><span class=err>#</span>
</span></span><span class=line><span class=cl><span class=w>              </span><span class=o>+--+-------------------------------------+-----+</span>
</span></span><span class=line><span class=cl><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=vg>write</span><span class=w> </span><span class=vg>sendto</span><span class=w>                </span><span class=vg>recvform</span><span class=w>  </span><span class=vg>read</span><span class=w>   </span><span class=o>|</span><span class=w>  </span><span class=o>&lt;</span><span class=vg>sys</span><span class=o>/</span><span class=vg>uio</span><span class=o>.</span><span class=vg>h</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=w>              </span><span class=o>|</span><span class=w>       </span><span class=vg>sendmsg</span><span class=w>               </span><span class=vg>recvmsg</span><span class=w>          </span><span class=o>|</span><span class=w>  </span><span class=vg>readv</span>
</span></span><span class=line><span class=cl><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=vg>read</span><span class=w>                                  </span><span class=vg>write</span><span class=w>  </span><span class=o>|</span><span class=w>  </span><span class=vg>writev</span>
</span></span><span class=line><span class=cl><span class=w>              </span><span class=o>+--+-------------------------------------+-----+</span>
</span></span><span class=line><span class=cl><span class=w>               </span><span class=o>%</span><span class=w> </span><span class=o>|</span><span class=w>                                     </span><span class=o>|</span><span class=w> </span><span class=o>%</span><span class=err>#</span>
</span></span><span class=line><span class=cl><span class=w>               </span><span class=o>+-+---+</span><span class=w>                               </span><span class=o>+-+---+</span>
</span></span><span class=line><span class=cl><span class=w>               </span><span class=o>|</span><span class=vg>close</span><span class=o>|</span><span class=w> </span><span class=vg>fin</span><span class=w> </span><span class=o>-&gt;</span><span class=w>                </span><span class=o>&lt;-</span><span class=w> </span><span class=vg>fin</span><span class=w>  </span><span class=o>|</span><span class=vg>close</span><span class=o>|</span>
</span></span><span class=line><span class=cl><span class=w>               </span><span class=o>+-----+</span><span class=w>                               </span><span class=o>+-----+</span><span class=w>    </span><span class=err>#</span><span class=w> </span><span class=vg>connfd</span>
</span></span><span class=line><span class=cl><span class=w>                                                         </span><span class=o>%</span><span class=w>      </span><span class=o>%</span><span class=w> </span><span class=vg>sockfd</span>
</span></span></code></pre></div><h2 id=macro-define>macro define<a href=#macro-define class=hanchor arialabel=Anchor>⚓</a></h2><p>Calling the API directly is too cumbersome, let&rsquo;s simplify it using macros.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl><span class=o>/*</span><span class=w> </span><span class=vg>struct</span><span class=w> </span><span class=vg>sockaddr_in</span><span class=w> </span><span class=vg>address</span><span class=w> </span><span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>init_address</span><span class=p>(</span><span class=vg>address</span><span class=p>,</span><span class=w> </span><span class=vg>ip</span><span class=p>,</span><span class=w> </span><span class=vg>port</span><span class=p>)</span><span class=w>                </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>bzero</span><span class=p>(</span><span class=o>&amp;</span><span class=vg>address</span><span class=p>,</span><span class=w> </span><span class=vg>sizeof</span><span class=p>(</span><span class=vg>address</span><span class=p>));</span><span class=w>                  </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>address</span><span class=o>.</span><span class=vg>sin_family</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=vg>AF_INET</span><span class=p>;</span><span class=w>                      </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>inet_pton</span><span class=p>(</span><span class=vg>AF_INET</span><span class=p>,</span><span class=w> </span><span class=vg>ip</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=vg>address</span><span class=o>.</span><span class=vg>sin_addr</span><span class=p>);</span><span class=w>         </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>address</span><span class=o>.</span><span class=vg>sin_port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=vg>htons</span><span class=p>(</span><span class=vg>port</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>Socket</span><span class=p>()</span><span class=w> </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>socket</span><span class=p>(</span><span class=vg>PF_INET</span><span class=p>,</span><span class=w> </span><span class=vg>SOCK_STREAM</span><span class=p>,</span><span class=w> </span><span class=il>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>Bind</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>server</span><span class=p>)</span><span class=w> </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>bind</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=vg>struct</span><span class=w> </span><span class=vg>sockaddr</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=vg>server</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=vg>socklen_t</span><span class=p>)</span><span class=vg>sizeof</span><span class=p>(</span><span class=vg>server</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>Listen</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>n</span><span class=p>)</span><span class=w> </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>listen</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>Accept</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>client</span><span class=p>,</span><span class=w> </span><span class=vg>client_len</span><span class=p>)</span><span class=w> </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>accept</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=vg>struct</span><span class=w> </span><span class=vg>sockaddr</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=vg>client</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=vg>client_len</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>Connect</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>server</span><span class=p>)</span><span class=w> </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>connect</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=vg>struct</span><span class=w> </span><span class=vg>sockaddr</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=vg>server</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=vg>socklen_t</span><span class=p>)</span><span class=vg>sizeof</span><span class=p>(</span><span class=vg>server</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>Close</span><span class=p>(</span><span class=vg>socket</span><span class=p>)</span><span class=w> </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>close</span><span class=p>(</span><span class=vg>socket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>Send</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>buf</span><span class=p>)</span><span class=w> </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>send</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>buf</span><span class=p>,</span><span class=w> </span><span class=vg>strlen</span><span class=p>(</span><span class=vg>buf</span><span class=p>),</span><span class=w> </span><span class=il>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=vg>define</span><span class=w> </span><span class=vg>Recv</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>buf</span><span class=p>)</span><span class=w> </span><span class=o>\</span>
</span></span><span class=line><span class=cl><span class=w>    </span><span class=vg>recv</span><span class=p>(</span><span class=vg>socket</span><span class=p>,</span><span class=w> </span><span class=vg>buf</span><span class=p>,</span><span class=w> </span><span class=vg>sizeof</span><span class=p>(</span><span class=vg>buf</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=il>1</span><span class=p>,</span><span class=w> </span><span class=il>0</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=boundary>boundary<a href=#boundary class=hanchor arialabel=Anchor>⚓</a></h2><p>Understand how the client and server start and terminate. What happens when certain errors occur, such as client host crash, client process crash, or network connection disruption?</p><p>Only by understanding these boundary conditions and their interaction with the TCP/IP protocol can robust client and server programs be written to handle these situations.</p><h3 id=rst-before-accept>RST before accept<a href=#rst-before-accept class=hanchor arialabel=Anchor>⚓</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.37120</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>S</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>3252709593</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>65495</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>mss</span><span class=w> </span><span class=il>65495</span><span class=p>,</span><span class=vg>sackOK</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>759990870</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>0</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>wscale</span><span class=w> </span><span class=il>7</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.54321</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.37120</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>S</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>139043462</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>3252709594</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>65483</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>mss</span><span class=w> </span><span class=il>65495</span><span class=p>,</span><span class=vg>sackOK</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>759990870</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>759990870</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>wscale</span><span class=w> </span><span class=il>7</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.37120</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>1</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>759990870</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>759990870</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.37120</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>R</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>1</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>1</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>759990870</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>759990870</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span></code></pre></div><h3 id=server-terminated>server terminated<a href=#server-terminated class=hanchor arialabel=Anchor>⚓</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.58730</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>S</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>559678739</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>65495</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>mss</span><span class=w> </span><span class=il>65495</span><span class=p>,</span><span class=vg>sackOK</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800516176</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>0</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>wscale</span><span class=w> </span><span class=il>7</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.54321</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.58730</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>S</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>2091989194</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>559678740</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>65483</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>mss</span><span class=w> </span><span class=il>65495</span><span class=p>,</span><span class=vg>sackOK</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800516176</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800516176</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>wscale</span><span class=w> </span><span class=il>7</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.58730</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>1</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800516176</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800516176</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.58730</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>P</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>1</span><span class=o>:</span><span class=il>7</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>1</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800532435</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800516176</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>6</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.54321</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.58730</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>7</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800532435</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800532435</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.54321</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.58730</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>P</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>1</span><span class=o>:</span><span class=il>7</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>7</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800532435</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800532435</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>6</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.58730</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>7</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800532435</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800532435</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.54321</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.58730</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>F</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>7</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>7</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800645539</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800532435</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.58730</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>8</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800645586</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800645539</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.58730</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>P</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>7</span><span class=o>:</span><span class=il>12</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>8</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>512</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>800775642</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>800645539</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>5</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.10.54321</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.58730</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>R</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>2091989202</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>0</span><span class=p>,</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>0</span>
</span></span></code></pre></div><h3 id=server-host-crash>server host crash<a href=#server-host-crash class=hanchor arialabel=Anchor>⚓</a></h3><p>It will retransmit before timeout.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.2.53050</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>P</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>17</span><span class=o>:</span><span class=il>19</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>17</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>502</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>2312873962</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>1837083938</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>2</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.2.53050</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>P</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>17</span><span class=o>:</span><span class=il>19</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>17</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>502</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>2312874549</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>1837083938</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>2</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.2.53050</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>P</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>17</span><span class=o>:</span><span class=il>19</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>17</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>502</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>2312875541</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>1837083938</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>2</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.2.53050</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>P</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>17</span><span class=o>:</span><span class=il>19</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>17</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>502</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>2312877525</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>1837083938</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>2</span>
</span></span><span class=line><span class=cl><span class=nl>192</span><span class=mf>.168.2.2.53050</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>192.168.2.10.54321</span><span class=o>:</span><span class=w> </span><span class=vg>Flags</span><span class=w> </span><span class=p>[</span><span class=vg>P</span><span class=o>.</span><span class=p>],</span><span class=w> </span><span class=vg>seq</span><span class=w> </span><span class=il>17</span><span class=o>:</span><span class=il>19</span><span class=p>,</span><span class=w> </span><span class=vg>ack</span><span class=w> </span><span class=il>17</span><span class=p>,</span><span class=w> </span><span class=vg>win</span><span class=w> </span><span class=il>502</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=vg>options</span><span class=w> </span><span class=p>[</span><span class=vg>nop</span><span class=p>,</span><span class=vg>nop</span><span class=p>,</span><span class=vg>TS</span><span class=w> </span><span class=vg>val</span><span class=w> </span><span class=il>2312881557</span><span class=w> </span><span class=vg>ecr</span><span class=w> </span><span class=il>1837083938</span><span class=p>],</span><span class=w> </span><span class=vg>length</span><span class=w> </span><span class=il>2</span>
</span></span></code></pre></div><h2 id=thoughts>thoughts<a href=#thoughts class=hanchor arialabel=Anchor>⚓</a></h2><p>Transitioning naturally from TCP/IP protocol to socket API, we see that the existing I/O operations are both cumbersome and inefficient.</p><p>So the problem in socket usage is how to handle I/O more effectively.</p><h2 id=refer>refer<a href=#refer class=hanchor arialabel=Anchor>⚓</a></h2><ul><li><em>High Performance Linux Service Programming - chapter 5</em></li><li><em>unpv1: the sockets networking api- chapter 5</em></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/post/0012/><span class=button__icon>←</span>
<span class=button__text>io mux & advanced io</span></a></span>
<span class="button next"><a href=/post/0010/><span class=button__text>TCP/IP stack in network programming</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://utteranc.es/client.js repo=zexsphere/zexsphere.github.io issue-term=pathname theme=dark-blue crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#socket-api-map>socket api map</a></li><li><a href=#macro-define>macro define</a></li><li><a href=#boundary>boundary</a><ul><li><a href=#rst-before-accept>RST before accept</a></li><li><a href=#server-terminated>server terminated</a></li><li><a href=#server-host-crash>server host crash</a></li></ul></li><li><a href=#thoughts>thoughts</a></li><li><a href=#refer>refer</a></li></ul></nav></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>:: Powered by <a href=http://gohugo.io>Hugo</a> 0.115.4</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><a id=back-to-top style=display:inline-block href=javascript:void(0); onclick='window.scrollTo({top:0,behavior:"smooth"})'><span class="iconfont icon-top"></span></a>
<script src=/assets/main.js?d41d8cd98f00b204e9800998ecf8427e></script>
<script>const addCopyButtons=function(e){document.querySelectorAll("pre > code").forEach(function(t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy";const s=document.createElement("div");s.className="copy-code-button-wrap",s.appendChild(n),n.addEventListener("click",function(){e.writeText(t.innerText).then(function(){n.blur(),n.innerText="✔️",setTimeout(function(){n.innerText="Copy"},2e3)},function(){n.innerText="Error"})});const o=t.parentNode;o.insertAdjacentElement("beforebegin",s)})},loadScript=(e,t)=>{var n=document.createElement("script");n.onerror=e=>{throw new URIError("The script "+e.target.src+" didn't load correctly.")},t&&(n.onload=t),document.head.insertAdjacentElement("beforeend",n),n.src=e},loadMermaidOnNeed=()=>{document.querySelectorAll(".mermaid").length>0&&loadScript("https://cdn.jsdelivr.net/npm/mermaid@8.10.1/dist/mermaid.min.js",()=>{document.head.insertAdjacentHTML("beforeend",`<style>.mermaid svg { background-color: #dadcd8 !important; }</style>`),mermaid.initialize({startOnLoad:!1,securityLevel:"strict",logLevel:1,theme:"neutral"}),mermaid.init(),console.log("mermaid init done")})},loadPlantUMLOnNeed=()=>{let e="language-plantuml";document.querySelectorAll("[class^="+e+"]").length>0&&loadScript("https://cdn.jsdelivr.net/gh/jmnote/plantuml-encoder@1.2.4/dist/plantuml-encoder.min.js",()=>{(function(){Array.prototype.forEach.call(document.querySelectorAll("[class^="+e+"]"),function(e){let t=document.createElement("IMG");t.loading="lazy",t.src="http://www.plantuml.com/plantuml/svg/~1"+plantumlEncoder.encode(e.innerText),e.parentNode.insertBefore(t,e),e.style.display="none"})})(),console.log("PlantUML init done")})};window.addEventListener("load",function(){const t=document.links;for(let e=0,n=t.length;e<n;e++)t[e].hostname!=window.location.hostname&&!t[e].href.startsWith("javascript:")&&!t[e].href.startsWith("mailto:")&&(t[e].target="_blank");document.querySelectorAll("#TableOfContents li").length>0&&(document.querySelector("#post-toc").style.display="block"),document.querySelectorAll("#post-toc a").forEach(e=>{e.addEventListener("click",e=>{document.querySelectorAll("#post-toc a").forEach(e=>{e.classList.remove("active")}),e.target.classList.add("active")})}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();let t=this.getAttribute("href").substring(1);window.history.pushState({},"","#"+t),document.getElementById(t).scrollIntoView({behavior:"smooth"})})}),navigator&&navigator.clipboard&&addCopyButtons(navigator.clipboard),loadPlantUMLOnNeed(),loadMermaidOnNeed()})</script></div></body></html>