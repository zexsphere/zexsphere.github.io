<!doctype html><html lang=en><head><meta charset=utf-8><meta name=referrer content="same-origin"><title>gcc optimization :: Zex</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="what is optimization for a program?
run faster use less memory, or consume fewer system resources. This can involve various techniques such as algorithmic improvements, code restructuring, memory management, and compiler optimizations.
Let&amp;rsquo;s take a look at compiler optimizations.
-O You can invoke GCC with -Q &amp;ndash;help=optimizers to find out the exact set of optimizations that are enabled at each level.
-O&amp;lt;level&amp;gt; The default level is 0. -O0 Reduce compilation time and make debugging produce the expected results."><meta name=keywords content=","><meta name=robots content="noodp"><link rel=canonical href=/post/0009/><link rel=stylesheet href=/assets/style.min.css?d41d8cd98f00b204e9800998ecf8427e><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/favicon/apple-icon-precomposed.png><link rel="shortcut icon" href=/img/favicon/orange.png><meta name=twitter:card content="summary"><meta property="og:type" content="article"><meta property="og:title" content="gcc optimization :: Zex"><meta property="og:description" content="People who have used gcc often come across optimization levels, compilation flags, and other parameters. What do these parameters represent? What role do they play in the process of obtaining an executable program?"><meta property="og:url" content="/post/0009/"><meta property="og:site_name" content="Zex"><meta property="og:image" content="/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2023-09-15 08:43:38 +0800 +0800"></head><body><div class="container center headings--one-size"><header class=header style=background-image:url(/img/mountain/mountains-g47d3aaa15_1280.jpg);background-position:50%;background-repeat:no-repeat;background-size:cover><div class=header__inner><div class=header__logo><a href=/><div class=logo>Zex</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li><li><a href=/explore>Explore</a></li><li><a href=/notes>Notes</a></li><li><a href=/exhibits>Exhibits</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/archive>Archive</a></li><li><a href=/explore>Explore</a></li><li><a href=/notes>Notes</a></li><li><a href=/exhibits>Exhibits</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title>gcc optimization</h1><div class=post-meta><span class=post-date>2023-09-15</span>
<span class=post-author>::
zexsphere</span></div><span class=post-tags>#<a href=/tags/gcc/>gcc</a>&nbsp;
#<a href=/tags/optimize/>optimize</a>&nbsp;</span><div class=post-content><div><p>what is optimization for a program?</p><ul><li>run faster</li><li>use less memory, or consume fewer system resources.</li></ul><p>This can involve various techniques such as algorithmic improvements, code restructuring, memory management, and compiler optimizations.</p><p>Let&rsquo;s take a look at compiler optimizations.</p><h2 id=-o>-O<a href=#-o class=hanchor arialabel=Anchor>⚓</a></h2><p>You can invoke <em>GCC with -Q &ndash;help=optimizers</em> to find out the exact set of optimizations that are enabled at each level.</p><ul><li><code>-O&lt;level></code> The default level is 0.<ul><li><p><code>-O0</code> Reduce compilation time and make debugging produce the expected results.</p></li><li><p><code>-O1</code> The compiler tries to reduce code size and execution time, without performing any optimizations that take a great deal of compilation time.</p></li><li><p><code>-O2</code> Optimize even more. GCC performs nearly all supported optimizations that do not involve a space-speed tradeoff. As compared to -O, this option increases both compilation time and the performance of the generated code.</p></li><li><p><code>-O3</code> Optimize yet more.</p></li></ul></li></ul><p><code>-O&lt;level></code> turns on all optimizations specified by <code>-O&lt;level - 1></code> also turns on other optimization flags.</p><ul><li><p><code>-Ofast</code> enables all -O3 optimizations and disregard strict standards compliance.</p></li><li><p><code>-Og</code> Optimize debugging experience. -Og should be the optimization level of choice for the standard edit-compile-debug cycle, offering a reasonable level of optimization while maintaining fast compilation and a good debugging experience. It is a better choice than -O0 for producing debuggable code because some compiler passes that collect debug information are disabled at -O0. Like -O0, -Og completely disables a number of optimization passes so that individual options controlling them have no effect. Otherwise -Og enables all -O1 optimization flags except for those that may interfere with debugging.</p></li><li><p><code>-Os</code> Optimize for size. -Os enables all -O2 optimizations except those that often increase code size. It also enables -finline-functions, causes the compiler to tune for code size rather than execution speed, and performs further optimizations designed to reduce code size.</p></li><li><p><code>-Oz</code> Optimize aggressively for size rather than speed. This may increase the number of instructions executed if those instructions require fewer bytes to encode. -Oz behaves similarly to -Os including enabling most -O2 optimizations.</p></li></ul><p>If you use multiple -O options, with or without level numbers, the last such option is the one that is effective.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl><span class=w>      </span><span class=vg>Og</span><span class=w>         </span><span class=vg>Os</span><span class=o>/</span><span class=vg>Oz</span><span class=w>               </span><span class=vg>Ofast</span><span class=w>                   </span><span class=il>1</span><span class=o>.</span><span class=w> </span><span class=vg>Og</span><span class=w>    </span><span class=vg>for</span><span class=w> </span><span class=vg>debug</span>
</span></span><span class=line><span class=cl><span class=w>      </span><span class=o>^</span><span class=w>          </span><span class=o>^</span><span class=w>                   </span><span class=o>^</span><span class=w>                       </span><span class=il>2</span><span class=o>.</span><span class=w> </span><span class=vg>Os</span><span class=o>/</span><span class=vg>Oz</span><span class=w> </span><span class=vg>for</span><span class=w> </span><span class=vg>size</span>
</span></span><span class=line><span class=cl><span class=w>      </span><span class=o>|</span><span class=w>          </span><span class=o>|</span><span class=w>                   </span><span class=o>|</span><span class=w>                       </span><span class=il>3</span><span class=o>.</span><span class=w> </span><span class=vg>Ofast</span><span class=w> </span><span class=vg>not</span><span class=w> </span><span class=vg>use</span>
</span></span><span class=line><span class=cl><span class=o>+----------+----------+----------+------&gt;</span><span class=w> </span><span class=vg>optimize</span><span class=w> </span><span class=vg>level</span><span class=w>   </span><span class=o>/-----------------------</span>
</span></span><span class=line><span class=cl><span class=vg>O0</span><span class=w>         </span><span class=vg>O1</span><span class=w>         </span><span class=vg>O2</span><span class=w>         </span><span class=vg>O3</span><span class=w>                        </span><span class=o>|</span><span class=w> </span><span class=vg>O0</span><span class=w> </span><span class=vg>for</span><span class=w> </span><span class=vg>debug</span><span class=w> </span><span class=vg>version</span>
</span></span><span class=line><span class=cl><span class=o>&gt;----------&gt;----------&gt;----------&gt;------&gt;</span><span class=w> </span><span class=vg>enabling</span><span class=w> </span><span class=vg>options</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=vg>O2</span><span class=w> </span><span class=vg>for</span><span class=w> </span><span class=vg>release</span><span class=w> </span><span class=vg>version</span>
</span></span></code></pre></div><p>Thinks for
<a href=https://meldmerge.org/>Meld</a>, which helps me compare the list of optimization options.</p><p>Some commonly used options:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl><span class=o>-</span><span class=vg>fomit</span><span class=o>-</span><span class=vg>frame</span><span class=o>-</span><span class=vg>pointer</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><h2 id=-g>-g<a href=#-g class=hanchor arialabel=Anchor>⚓</a></h2><ul><li><code>-g&lt;level></code> The default level is 2.<ul><li><p><code>-g0</code> produces no debug information at all. Thus, -g0 negates -g.</p></li><li><p><code>-g1</code> produces minimal information, enough for making backtraces in parts of the program that you don’t plan to debug. This includes descriptions of functions and external variables, and line number tables, but no information about local variables.</p></li><li><p><code>-g2</code> between g1 and g3. And -g2 equals -g.</p></li><li><p><code>-g3</code> includes extra information, such as <strong>all the macro definitions</strong> present in the program. Some debuggers support macro expansion when you use -g3.</p></li></ul></li></ul><p>If you use multiple -O options, with or without level numbers, the last such option is the one that is effective.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl><span class=vg>g0</span><span class=w>         </span><span class=vg>g1</span><span class=w>         </span><span class=vg>g2</span><span class=w>         </span><span class=vg>g3</span><span class=w>                        </span><span class=o>|</span><span class=w> </span><span class=vg>g2</span><span class=w> </span><span class=vg>for</span><span class=w> </span><span class=vg>debug</span><span class=w> </span><span class=vg>version</span>
</span></span><span class=line><span class=cl><span class=o>&gt;----------&gt;----------&gt;----------&gt;------&gt;</span><span class=w> </span><span class=vg>debug</span><span class=w> </span><span class=vg>level</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=vg>g0</span><span class=w> </span><span class=vg>for</span><span class=w> </span><span class=vg>release</span><span class=w> </span><span class=vg>version</span>
</span></span><span class=line><span class=cl><span class=w>                      </span><span class=o>-</span><span class=vg>g</span>
</span></span></code></pre></div><p>In addition, command <em>strip</em> can remove the debugging information from executable programs. As a result, the program size is reduced.</p><h2 id=attributes>attributes<a href=#attributes class=hanchor arialabel=Anchor>⚓</a></h2><p>Some common use cases include:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-basic data-lang=basic><span class=line><span class=cl><span class=vg>__attribute__</span><span class=w> </span><span class=p>((</span><span class=vg>always_inline</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=vg>__attribute__</span><span class=w> </span><span class=p>((</span><span class=vg>noreturn</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=vg>__attribute__</span><span class=w> </span><span class=p>((</span><span class=vg>weak</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=vg>__attribute__</span><span class=w> </span><span class=p>((</span><span class=vg>visibility</span><span class=w> </span><span class=p>(</span><span class=s2>&#34;hidden&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=vg>__attribute__</span><span class=w> </span><span class=p>((</span><span class=vg>packed</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p>Perhaps I should write another article to elaborate on this.</p><h2 id=summary>summary<a href=#summary class=hanchor arialabel=Anchor>⚓</a></h2><p>As you can see, the mechanism of GCC is quite extensive. Although many things may not be needed in daily use, it is still beneficial to have some knowledge about them.</p><p>The optimization mechanism of GCC should be considered as a secondary means. Given the capabilities of the current machine, greater attention should be given to algorithmic improvements, code restructuring, and memory management.</p><h2 id=refer>refer<a href=#refer class=hanchor arialabel=Anchor>⚓</a></h2><ul><li><em><a href=https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html#Optimize-Options>gcc optimize options</a></em></li><li><em><a href="https://news.ycombinator.com/item?id=23140682">hacknews about gcc optimize level</a></em></li><li><em><a href=https://gcc.gnu.org/onlinedocs/gcc/Debugging-Options.html#Debugging-Options>gcc debugging options</a></em></li><li><em>Attributes of
<a href=https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html>Function</a></em> /
<a href=https://gcc.gnu.org/onlinedocs/gcc/Variable-Attributes.html>Variables</a> /
<a href=https://gcc.gnu.org/onlinedocs/gcc/Type-Attributes.html>Type</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/post/0010/><span class=button__icon>←</span>
<span class=button__text>TCP/IP stack in network programming</span></a></span>
<span class="button next"><a href=/post/0008/><span class=button__text>CMake components - use GTest</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://utteranc.es/client.js repo=zexsphere/zexsphere.github.io issue-term=pathname theme=dark-blue crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#-o>-O</a></li><li><a href=#-g>-g</a></li><li><a href=#attributes>attributes</a></li><li><a href=#summary>summary</a></li><li><a href=#refer>refer</a></li></ul></nav></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>:: Powered by <a href=http://gohugo.io>Hugo</a> 0.115.4</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><a id=back-to-top style=display:inline-block href=javascript:void(0); onclick='window.scrollTo({top:0,behavior:"smooth"})'><span class="iconfont icon-top"></span></a>
<script src=/assets/main.js?d41d8cd98f00b204e9800998ecf8427e></script>
<script>const addCopyButtons=function(e){document.querySelectorAll("pre > code").forEach(function(t){const n=document.createElement("button");n.className="copy-code-button",n.type="button",n.innerText="Copy";const s=document.createElement("div");s.className="copy-code-button-wrap",s.appendChild(n),n.addEventListener("click",function(){e.writeText(t.innerText).then(function(){n.blur(),n.innerText="✔️",setTimeout(function(){n.innerText="Copy"},2e3)},function(){n.innerText="Error"})});const o=t.parentNode;o.insertAdjacentElement("beforebegin",s)})},loadScript=(e,t)=>{var n=document.createElement("script");n.onerror=e=>{throw new URIError("The script "+e.target.src+" didn't load correctly.")},t&&(n.onload=t),document.head.insertAdjacentElement("beforeend",n),n.src=e},loadMermaidOnNeed=()=>{document.querySelectorAll(".mermaid").length>0&&loadScript("https://cdn.jsdelivr.net/npm/mermaid@8.10.1/dist/mermaid.min.js",()=>{document.head.insertAdjacentHTML("beforeend",`<style>.mermaid svg { background-color: #dadcd8 !important; }</style>`),mermaid.initialize({startOnLoad:!1,securityLevel:"strict",logLevel:1,theme:"neutral"}),mermaid.init(),console.log("mermaid init done")})},loadPlantUMLOnNeed=()=>{let e="language-plantuml";document.querySelectorAll("[class^="+e+"]").length>0&&loadScript("https://cdn.jsdelivr.net/gh/jmnote/plantuml-encoder@1.2.4/dist/plantuml-encoder.min.js",()=>{(function(){Array.prototype.forEach.call(document.querySelectorAll("[class^="+e+"]"),function(e){let t=document.createElement("IMG");t.loading="lazy",t.src="http://www.plantuml.com/plantuml/svg/~1"+plantumlEncoder.encode(e.innerText),e.parentNode.insertBefore(t,e),e.style.display="none"})})(),console.log("PlantUML init done")})};window.addEventListener("load",function(){const t=document.links;for(let e=0,n=t.length;e<n;e++)t[e].hostname!=window.location.hostname&&!t[e].href.startsWith("javascript:")&&!t[e].href.startsWith("mailto:")&&(t[e].target="_blank");document.querySelectorAll("#TableOfContents li").length>0&&(document.querySelector("#post-toc").style.display="block"),document.querySelectorAll("#post-toc a").forEach(e=>{e.addEventListener("click",e=>{document.querySelectorAll("#post-toc a").forEach(e=>{e.classList.remove("active")}),e.target.classList.add("active")})}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();let t=this.getAttribute("href").substring(1);window.history.pushState({},"","#"+t),document.getElementById(t).scrollIntoView({behavior:"smooth"})})}),navigator&&navigator.clipboard&&addCopyButtons(navigator.clipboard),loadPlantUMLOnNeed(),loadMermaidOnNeed()})</script></div></body></html>